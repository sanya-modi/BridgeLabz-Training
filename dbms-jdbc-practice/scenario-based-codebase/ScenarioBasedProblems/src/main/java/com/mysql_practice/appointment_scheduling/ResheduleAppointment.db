/*
UC-3.4: Reschedule Appointment
Actor: Receptionist
Flow: Verify new slot availability, update appointment date/time and doctor_id if needed. Use transaction with ROLLBACK capability if conflicts detected.
*/

//Check new slot availability

SELECT COUNT(*) 
FROM appointments_dc
WHERE doctor_id = 1
AND appointment_date = '2026-02-21'
AND appointment_time = '11:00:00'
AND status = 'SCHEDULED';
+----------+
| COUNT(*) |
+----------+
|        0 |
+----------+

//If slot available â†’ Transaction Update

START TRANSACTION;

UPDATE appointments_dc
SET appointment_date = '2026-02-21',
    appointment_time = '11:00:00'
WHERE appointment_id = 1;

COMMIT;

SELECT appointment_id, appointment_date, appointment_time
FROM appointments_dc;
+----------------+------------------+------------------+
| appointment_id | appointment_date | appointment_time |
+----------------+------------------+------------------+
|              1 | 2026-02-21       | 11:00:00         |
|              7 | 2026-02-20       | 09:00:00         |
|              8 | 2026-02-20       | 10:00:00         |
|              9 | 2026-02-20       | 11:00:00         |
|             10 | 2026-02-21       | 09:30:00         |
|             11 | 2026-02-21       | 12:00:00         |
+----------------+------------------+------------------+
